<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PRISM</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
    /* Paleta de Cores e Estilos do Windows 2000 com toque governamental */
    :root { 
        --win-gray: #d3d3d3;
        --win-dark-gray: #808080;
        --win-light-gray: #e0e0e0;
        --win-blue-start: #0a246a;
        --win-blue-end: #a6c0e1;
        --win-button-face: #f0f0f0;
        --win-button-highlight: #ffffff;
        --win-button-shadow: #808080;
        --win-text: #000000;
        --win-success: #008000;
        --win-error: #ff0000;
        --spy-bg: #22252a; /* Cor de fundo mais escura */
        --spy-text: #00ff00; /* Texto de terminal em verde */
        --spy-border: #3c3c3c; /* Borda escura */
    }

    /* Animação para o efeito de "ruído estático" */
    @keyframes static-noise {
        0% { transform: scale(1.0, 1.0); }
        10% { transform: scale(1.02, 0.98); }
        20% { transform: scale(0.98, 1.02); }
        30% { transform: scale(1.0, 1.0); }
        100% { transform: scale(1.0, 1.0); }
    }

    /* Animação para o texto piscar */
    @keyframes blink {
        50% { opacity: 0; }
    }
    
    body { 
        margin: 0; 
        font-family: 'Tahoma', 'MS Sans Serif', 'Arial', sans-serif; 
        background-color: var(--spy-bg); 
        color: var(--win-light-gray); /* Cor de texto padrão mais clara */
        overflow-x: hidden; 
        position: relative; 
        background-image: none;
    }

    /* Recriando a barra de título do Windows 2000 */
    .topbar { 
        height: 30px; 
        padding: 0 5px; 
        background-color: var(--win-blue-start);
        background: linear-gradient(90deg, var(--win-blue-start) 0%, var(--win-blue-end) 100%);
        border-top: 2px solid var(--win-button-highlight);
        border-left: 2px solid var(--win-button-highlight);
        border-right: 2px solid var(--win-button-shadow);
        border-bottom: 2px solid var(--win-button-shadow);
        display: flex; 
        align-items: center; 
        justify-content: space-between; 
        z-index: 10; 
        position: relative;
    }
    .topbar h1 { 
        margin: 0; 
        font-size: 14px; 
        color: #ffffff; 
        font-weight: bold;
        display: flex; 
        align-items: center; 
    }
    .topbar img { 
        height: 20px; 
        margin-right: 5px; 
    }
    
    .container { 
        display: flex; 
        margin: 10px;
        background-color: var(--win-dark-gray); /* Fundo mais escuro */
        border-top: 1px solid var(--win-button-highlight);
        border-left: 1px solid var(--win-button-highlight);
        border-right: 1px solid var(--win-button-shadow);
        border-bottom: 1px solid var(--win-button-shadow);
    }
    
    /* Recriando o estilo da sidebar como um painel lateral */
    .sidebar { 
        width: 220px; 
        background-color: var(--spy-bg); /* Fundo da barra lateral mais escuro */
        padding: 10px; 
        border-right: 1px solid var(--win-dark-gray); 
        z-index: 5; 
        position: relative;
    }
    .sidebar h2 { 
        font-size: 12px; 
        color: #00ff00; /* Cor de destaque verde */
        margin-bottom: 10px; 
        border-bottom: 1px solid #00ff00; 
        padding-bottom: 5px; 
        font-weight: bold;
    }
    .sidebar ul { 
        list-style: none; 
        padding: 0; 
    }
    .sidebar li { 
        margin: 5px 0; 
        font-size: 12px; 
        padding: 2px 5px; 
        border: 1px solid transparent;
        color: var(--win-light-gray);
    }
    .sidebar li.sidebar-button { 
        cursor: pointer; 
    }
    .sidebar li.sidebar-button:hover { 
        background-color: #0a246a; 
        color: #ffffff;
    }
    
    .main-content { 
        margin-left: 0; 
        flex: 1; 
        padding: 15px; 
        background-color: var(--spy-bg); /* Fundo da área de conteúdo mais escuro */
    }
    
    /* Estilo para as abas do Windows 2000 */
    .tab-bar { 
        display: flex; 
        border-bottom: 1px solid var(--win-dark-gray);
        margin-bottom: 10px; 
    }
    .tab-button { 
        background-color: var(--spy-bg);
        border: 1px solid var(--win-dark-gray);
        border-bottom: 1px solid var(--spy-bg); /* Borda mais discreta */
        color: var(--win-light-gray); 
        padding: 4px 10px; 
        font-size: 12px; 
        cursor: pointer; 
        margin-right: 2px;
        position: relative;
        top: 1px;
    }
    .tab-button:hover {
        background-color: var(--spy-border);
    }
    .tab-button.active { 
        background-color: var(--win-dark-gray); 
        border-bottom: 1px solid transparent; 
        z-index: 2;
        color: #ffffff;
    }
    .tab-pane { 
        display: none; 
    }
    .tab-pane.active { 
        display: block; 
    }
    
    /* Estilizando formulários e botões */
    .target-form { 
        display: flex; 
        margin-bottom: 10px; 
    }
    .target-form input, .xkeyscore-form input { 
        flex: 1; 
        padding: 4px; 
        border: 1px solid var(--spy-border); 
        background-color: var(--spy-bg); 
        color: #00ff00; /* Texto de entrada em verde */
        margin-right: 5px; 
        border-top: 1px solid var(--spy-border);
        border-left: 1px solid var(--spy-border);
        border-right: 1px solid var(--spy-border);
        border-bottom: 1px solid var(--spy-border);
    }
    .target-form button, .xkeyscore-form button, .bullrun-button { 
        padding: 4px 10px; 
        border: 1px solid var(--win-text);
        border-top: 1px solid var(--win-button-highlight);
        border-left: 1px solid var(--win-button-highlight);
        border-right: 1px solid var(--win-button-shadow);
        border-bottom: 1px solid var(--win-button-shadow);
        background-color: var(--win-gray);
        color: var(--win-text); 
        font-weight: normal; 
        cursor: pointer; 
    }
    .target-form button:active, .xkeyscore-form button:active, .bullrun-button:active {
        border-top: 1px solid var(--win-button-shadow);
        border-left: 1px solid var(--win-button-shadow);
        border-right: 1px solid var(--win-button-highlight);
        border-bottom: 1px solid var(--win-button-highlight);
    }

    /* Estilo de caixas de informação e logs */
    .data-panel { 
        display: grid; 
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); 
        gap: 10px; 
    }
    .card { 
        background-color: var(--spy-bg); 
        padding: 10px; 
        font-size: 12px; 
        border: 1px solid var(--spy-border);
        color: var(--win-light-gray);
    }
    .card h3, .card strong {
        color: #00ff00; /* Destaque verde para títulos e negritos */
    }
    .logs, .xkeyscore-results, .bullrun-log, .terminal-content { 
        margin-top: 5px; 
        background-color: #000000; /* Fundo do log preto para contraste */
        border: 1px solid var(--spy-border); 
        padding: 10px; 
        height: 250px; 
        overflow-y: auto; 
        font-family: 'Courier New', Courier, monospace; 
        font-size: 12px; 
        color: #00ff00; /* Texto do log em verde */
        animation: none;
    }

    /* Cores de log adaptadas */
    .log-entry { 
        margin: 0; 
        padding: 1px 0; 
        white-space: pre-wrap; 
    }
    .log-timestamp { 
        color: #00ff00; 
    }
    .log-action { 
        color: #ff0000; /* Vermelho para ações importantes */
        font-weight: bold; 
    }
    .log-success { 
        color: #00ff00; 
    }
    .log-info { 
        color: #00ffff; /* Ciano para informações gerais */
    }

    .skynet-map { 
        width: 100%; 
        height: auto; 
        border: 1px solid var(--spy-border); 
    }

    /* Barra de progresso com estilo mais técnico */
    .progress-bar {
        width: 100%;
        height: 10px;
        background-color: var(--spy-border);
        border: 1px solid var(--spy-border);
        overflow: hidden;
        margin-top: 5px;
        padding: 2px;
    }
    .progress-bar-fill {
        height: 100%;
        width: 0%;
        background-color: #00ff00; /* Barra de progresso verde */
        transition: width 0.5s ease-in-out;
    }
    
    .status-pulse {
        color: #00ff00;
        animation: blink 1s steps(1) infinite;
    }

    /* Estilo para a janela do terminal */
    .terminal-window {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 70%;
        max-width: 800px;
        height: 500px;
        background-color: var(--win-dark-gray);
        border: 2px solid var(--win-text);
        box-shadow: 5px 5px 10px rgba(0,0,0,0.5);
        z-index: 100;
        display: none;
        resize: both;
        overflow: hidden;
    }

    .terminal-topbar {
        height: 25px;
        background-color: var(--win-blue-start);
        background: linear-gradient(90deg, var(--win-blue-start) 0%, var(--win-blue-end) 100%);
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 5px;
        cursor: grab; /* Indica que o elemento é arrastável */
    }
    .terminal-topbar:active {
        cursor: grabbing;
    }


    .terminal-topbar-title {
        font-size: 14px;
        color: #fff;
        font-weight: bold;
    }

    .terminal-close-btn {
        background-color: var(--win-error);
        color: #fff;
        font-weight: bold;
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px solid var(--win-text);
        cursor: pointer;
    }

    /* Estilo para o gráfico de conexões simulado */
    .social-graph-container {
        height: 400px;
        background-color: #111;
        border: 1px solid #00ff00;
        margin-top: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #00ff00;
        font-family: 'Courier New', Courier, monospace;
        text-align: center;
        overflow: hidden;
        position: relative;
    }

    .graph-node {
        position: absolute;
        background-color: #00ff00;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        box-shadow: 0 0 5px #00ff00;
        animation: pulse 2s infinite ease-in-out;
    }

    .graph-node.main {
        background-color: #ff0000;
        width: 12px;
        height: 12px;
        box-shadow: 0 0 8px #ff0000;
        animation: none;
    }

    .graph-text {
        position: absolute;
        font-size: 10px;
        white-space: nowrap;
        transform: translate(-50%, -50%);
        color: #fff;
        text-shadow: 0 0 2px #000;
    }
    
    @keyframes pulse {
        0%, 100% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.5); opacity: 0.5; }
    }
</style>
</head>
<body>

<div class="topbar">
    <h1><img src="https://upload.wikimedia.org/wikipedia/commons/d/d2/PRISM_logo_%28PNG%29.png" alt="PRISM Logo">PRISM</h1>
</div>

<div class="container">
    <div class="sidebar">
        <h2>Modulos Operacionais</h2>
        <ul>
            <li class="sidebar-button" onclick="requestData('GOOGLE-API-INT')">Google</li>
            <li class="sidebar-button" onclick="requestData('FACEBOOK-GRAPH')">Facebook</li>
            <li class="sidebar-button" onclick="requestData('MS-AZURE-GATEWAY')">Microsoft</li>
            <li class="sidebar-button" onclick="requestData('APPLE-CLOUD-CORE')">Apple</li>
            <li class="sidebar-button" onclick="requestData('META-MSG-API')">Whatsapp</li>
            <li class="sidebar-button" onclick="requestData('TLGRM-SEC-SVC')">Telegram</li>
            <li class="sidebar-button" onclick="requestData('GLOBAL-ISP-TAP')">Major ISPs</li>
        </ul>
        <h2 style="margin-top: 20px;">CRYPTO Operações</h2>
        <ul>
            <li class="sidebar-button" onclick="runComplexOperation()">Iniciar Decriptação BULLRUN</li>
            <li class="sidebar-button" onclick="runHeartbleedAttack()">Explorar Chaves HEARTBLEED</li>
            <li class="sidebar-button" onclick="openTerminal()">Abrir Terminal de Rede</li>
        </ul>
    </div>

    <div class="main-content">
        <div class="tab-bar">
            <button class="tab-button active" onclick="openTab('prism', this)">PRISM (INTEL)</button>
            <button class="tab-button" onclick="openTab('xkeyscore', this)">XKEYSCORE (ANALISE)</button>
            <button class="tab-button" onclick="openTab('bullrun', this)">BULLRUN (DECRIPT)</button>
            <button class="tab-button" onclick="openTab('skynet', this)">SKYNET (GEOINT)</button>
            <button class="tab-button" onclick="openTab('systems', this)">SISTEMAS</button>
        </div>

        <div id="prism-tab" class="tab-pane active">
            <h2>Monitoramento de Alvos Ativos</h2>
            <div class="target-form">
                <input type="text" id="targetInput" placeholder="Inserir ALVO-ID (ex: P-12345678, user@domain)...">
                <button onclick="addTarget()">Adquirir Alvo</button>
            </div>
            <div class="data-panel" id="dataPanel"></div>
            <h2 style="margin-top:20px;">Registro de Sistema PRISM</h2>
            <div class="logs" id="prism-logs"></div>
        </div>

        <div id="xkeyscore-tab" class="tab-pane">
            <h2>XKEYSCORE - Mineração de Dados Global</h2>
            <div class="xkeyscore-form">
                <input type="text" id="xkeyscoreInput" placeholder="Inserir consulta (ex: 'docs.cript', 'plano-b.pdf', Endereço IP)...">
                <button onclick="runXkeyscoreSearch()">Executar Consulta</button>
                <button onclick="runStormcloudAnalysis()">Análise Social (STORMCLOUD)</button>
            </div>
            <div class="xkeyscore-results" id="xkeyscore-results">Aguardando consulta...</div>
        </div>

        <div id="bullrun-tab" class="tab-pane">
            <h2>BULLRUN - Divisão de Criptoanálise</h2>
            <p>Monitorando fluxos de dados criptografados. Selecione um alvo e inicie o protocolo de decriptação.</p>
            <div class="progress-bar">
                <div id="bullrun-progress-fill" class="progress-bar-fill"></div>
            </div>
            <div class="bullrun-log" id="bullrun-log">Nenhuma tarefa de decriptação em andamento.</div>
        </div>
        
        <div id="skynet-tab" class="tab-pane">
            <h2>SKYNET - Análise Geoespacial</h2>
            <p>Rastreamento em tempo real de ativos e ameaças globais.</p>
            <img src="https://i.imgur.com/gG8gZ5r.png" alt="Global Threat Map" class="skynet-map">
        </div>

        <div id="systems-tab" class="tab-pane">
            <h2>Informações do Sistema</h2>
            <div class="card">
                <h3>PRISM NSA Suite v5.0</h3>
                <p>Versão de Software: 5.0.1.2308.c001</p>
                <p>Status: <span class="status-pulse">▶</span> Operacional</p>
                <p>Última Atualização: 25 de agosto de 2025</p>
                <p>Integridade do Sistema: <strong>100%</strong></p>
            </div>
            <h3 style="margin-top: 20px; color: #00ff00;">Funcionalidades Principais</h3>
            <ul style="list-style-type: none; padding-left: 10px;">
                <li><strong style="color: #00ffff;">PRISM (INTEL):</strong> Aquisição de dados de comunicações e monitoramento de alvos em tempo real.</li>
                <li><strong style="color: #00ffff;">XKEYSCORE (ANÁLISE):</strong> Mineração e análise de grandes volumes de dados globais para identificar padrões.</li>
                <li><strong style="color: #00ffff;">BULLRUN (CRIPTANÁLISE):</strong> Protocolos de criptoanálise avançada para decriptar fluxos de dados de alta segurança.</li>
                <li><strong style="color: #00ffff;">SKYNET (GEOINT):</strong> Rastreamento e análise geoespacial de alvos e ameaças globais.</li>
                <li><strong style="color: #00ffff;">HEARTBLEED (EXPLOIT):</strong> Extração de chaves de segurança via exploração de vulnerabilidades.</li>
                <li><strong style="color: #00ffff;">STORMCLOUD (ANÁLISE SOCIAL):</strong> Mapeamento e perfil psicológico de redes de contatos.</li>
            </ul>
        </div>
    </div>
</div>

<!-- Janela de Terminal (inicialmente oculta) -->
<div id="terminalWindow" class="terminal-window">
    <div class="terminal-topbar">
        <span class="terminal-topbar-title">Terminal de Captura de Pacotes</span>
        <button class="terminal-close-btn" onclick="closeTerminal()">X</button>
    </div>
    <pre id="terminalContent" class="terminal-content">Aguardando início da captura...</pre>
</div>

<script>
// --- ELEMENTOS DOM E VARIÁVEIS DE SISTEMA ---
const dataPanel = document.getElementById('dataPanel');
const prismLogs = document.getElementById('prism-logs');
const bullrunLog = document.getElementById('bullrun-log');
const xkeyscoreResults = document.getElementById('xkeyscore-results');
const bullrunProgress = document.getElementById('bullrun-progress-fill');
const terminalWindow = document.getElementById('terminalWindow');
const terminalContent = document.getElementById('terminalContent');
let targets = [];
let terminalInterval = null;

// --- CONTEXTO DE DADOS SIMULADOS ---
const deviceDatabase = [ 
    { manufacturer: 'Apple', model: 'iPhone 17 Pro', os: 'iOS 19.0.1', id: 'APL_IOS_2309' }, 
    { manufacturer: 'Samsung', model: 'Galaxy S26 Ultra', os: 'Android 16', id: 'SMS_AND_7734' }, 
    { manufacturer: 'Google', model: 'Pixel 10 Pro', os: 'Android 16', id: 'GOO_PIX_4490' } 
];
const carriers = ["AT&T", "Verizon", "T-Mobile", "Vodafone", "Telefonica"];
const networkProtocols = ["TCP", "UDP", "ICMP", "HTTP/3", "QUIC", "TLS"];
const systemEvents = ["SYSTEM-INIT", "TARGET-ACQ", "DATA-INJECTION", "STREAM-ANALYSIS", "GEO-LOC-PING", "ENCRYPT-BYPASS"];
const payloadSnippets = [
    "GET /images/logo.png",
    "POST /api/user-data",
    "DNS Query for google.com",
    "Encrypted TLS 1.3 Handshake",
    "I'm at the location, waiting for the signal.",
    "This is a test message. Please disregard.",
    "Sending attachment: project_plans.pdf"
];
const socialConnections = ["Alice", "Bob", "Charlie", "David", "Eve", "Frank"];

// --- FUNÇÕES DE UTILIDADE ---
function getRandomItem(arr) { return arr[Math.floor(Math.random() * arr.length)]; }
function generateLogEntry(message, type = 'info', logEl = prismLogs) { 
    const p = document.createElement('p'); 
    p.className = 'log-entry'; 
    p.innerHTML = `<span class="log-timestamp">[${new Date().toISOString()}]</span> <span class="log-${type}">${message}</span>`; 
    logEl.appendChild(p); 
    logEl.scrollTop = logEl.scrollHeight; 
}
function generateRandomIP() { return Array.from({length: 4}, () => Math.floor(Math.random() * 256)).join('.'); }
function generateRandomProtocol() { return getRandomItem(networkProtocols); }
function generateRandomLocation() {
    const lat = (Math.random() * (40 - -40) + -40).toFixed(5);
    const lon = (Math.random() * (120 - -120) + -120).toFixed(5);
    return { lat, lon };
}
function generateRandomBytes() { return (Math.random() * 1024).toFixed(2); }
function getRandomPort() { return Math.floor(Math.random() * (65535 - 1024 + 1)) + 1024; }
function getRandomPayload() { return getRandomItem(payloadSnippets); }

// --- LÓGICA DE GERENCIAMENTO DE ABAS ---
function openTab(tabName, element) {
    document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
    document.getElementById(`${tabName}-tab`).classList.add('active');
    element.classList.add('active');
}

// --- LÓGICA DE AQUISIÇÃO DE ALVOS PRISM ---
function addTarget() { 
    const input = document.getElementById('targetInput'); 
    const targetName = input.value.trim(); 
    if (!targetName) {
        generateLogEntry("ERRO: ALVO-ID inválido. Acesso negado.", 'action');
        return;
    }
    if (targets.some(t => t.name === targetName)) {
        generateLogEntry(`AVISO: O alvo ${targetName} já está ativo.`, 'action');
        return;
    }

    const device = getRandomItem(deviceDatabase);
    const location = generateRandomLocation();
    const newTarget = {
        name: targetName,
        deviceID: device.id,
        device: device.model,
        os: device.os,
        location: location,
        ip: generateRandomIP(),
        carrier: getRandomItem(carriers),
        protocol: generateRandomProtocol(),
        session: 'ACTIVE',
        connectedDevices: []
    };
    targets.push(newTarget);
    createTargetCard(newTarget);
    generateLogEntry(`[${systemEvents[1]}] ${targetName} adquirido. Iniciando o fluxo de dados da fonte: ${newTarget.carrier}.`, 'success');
    input.value = ''; 
}

function createTargetCard(target) { 
    const cardId = `card-${target.name.replace(/\s+/g, '-')}`; 
    const card = document.createElement('div'); 
    card.className = 'card'; 
    card.id = cardId; 
    card.innerHTML = `
        <h3>ALVO: <span class="status-pulse">▶</span> ${target.name}</h3>
        <p><strong>Dispositivo:</strong> ${target.device} (${target.os})</p>
        <p><strong>ID do Dispositivo:</strong> ${target.deviceID}</p>
        <p><strong>Operadora:</strong> ${target.carrier}</p>
        <p><strong>Protocolo:</strong> <span class="data-protocol">${target.protocol}</span></p>
        <p><strong>IP:</strong> <span class="data-ip">${target.ip}</span></p>
        <p><strong>Fluxo de Dados:</strong> <span class="data-bytes">0.00</span> MB/s</p>
        <p><strong>Geo-Localização:</strong> <span class="data-lat">${target.location.lat}</span>, <span class="data-lon">${target.location.lon}</span></p>
        <p><strong>Dispositivos Conectados:</strong> <span id="${cardId}-devices">Nenhum</span></p>
    `; 
    dataPanel.appendChild(card); 
}

// --- LÓGICA DE REQUISIÇÃO DE DADOS ---
function requestData(source) { 
    if (targets.length === 0) { 
        generateLogEntry("ERRO: Nenhum alvo ativo para a solicitação de dados.", 'action'); 
        return; 
    } 
    const target = getRandomItem(targets); 
    generateLogEntry(`[${systemEvents[2]}] Iniciando a extração de dados de [${source}] para o ALVO ${target.name}...`, 'info'); 
    setTimeout(() => {
        generateLogEntry(`[${systemEvents[3]}] Fluxo de dados estabelecido para ${target.name}.`, 'success');
    }, 2000);
}

// --- LÓGICA DE CRIPTANÁLISE BULLRUN ---
function runComplexOperation() {
    if (targets.length === 0) {
        generateLogEntry("ERRO: Nenhum alvo ativo para a operação complexa. Adquira um alvo primeiro.", 'action', bullrunLog);
        return;
    }
    const target = getRandomItem(targets);
    simulateBullrunAttack(target);
}

function simulateBullrunAttack(target) {
    let keyVaultSource = "OEM_TRUSTZONE_KEY_EXTRACTION";
    if (target.device === 'iPhone 17 Pro') {
        keyVaultSource = "APPLE_ICLOUD_KEY_VAULT";
    } else if (target.device === 'Galaxy S26 Ultra') {
        keyVaultSource = "SAMSUNG_KNOX_VAULT";
    } else if (target.device === 'Pixel 10 Pro') {
        keyVaultSource = "GOOGLE_TITAN_CHIP_EXPLOIT";
    }

    const steps = [
        { msg: `[TAREFA-001] Iniciando ataque MITM em ALVO ${target.name} via ${target.carrier}...`, type: 'action', delay: 0, progress: 10 },
        { msg: `[TAREFA-002] Analisando o fluxo de dados criptografados (${target.protocol})...`, type: 'info', delay: 1500, progress: 25 },
        { msg: `[TAREFA-003] Solicitando chaves de sessão da fonte parceira (${keyVaultSource})...`, type: 'info', delay: 3000, progress: 50 },
        { msg: `[TAREFA-004] Recebendo fragmentos de chaves. Reconstruindo a chave de decriptografia...`, type: 'info', delay: 5000, progress: 75 },
        { msg: `[TAREFA-005] Camada de criptografia ${target.protocol} ignorada. Fluxo de dados descriptografado em tempo real estabelecido.`, type: 'success', delay: 7000, progress: 100 }
    ];
    
    bullrunLog.innerHTML = '';
    bullrunProgress.style.width = '0%';
    steps.forEach(step => {
        setTimeout(() => {
            generateLogEntry(step.msg, step.type, bullrunLog);
            bullrunProgress.style.width = `${step.progress}%`;
        }, step.delay);
    });
    openTab('bullrun', document.querySelector('.tab-button[onclick="openTab(\'bullrun\', this)"]'));
}

function runHeartbleedAttack() {
    if (targets.length === 0) {
        generateLogEntry("ERRO: Nenhum alvo ativo para a operação HEARTBLEED. Adquira um alvo primeiro.", 'action', bullrunLog);
        return;
    }
    const target = getRandomItem(targets);
    bullrunLog.innerHTML = '';
    const progressFill = document.getElementById('bullrun-progress-fill');
    progressFill.style.width = '0%';
    generateLogEntry(`[EXPLOIT] Iniciando exploração de vulnerabilidade HEARTBLEED contra ALVO ${target.name}...`, 'action', bullrunLog);
    
    let progress = 0;
    const progressInterval = setInterval(() => {
        progress += 10;
        progressFill.style.width = `${progress}%`;
        if (progress >= 100) {
            clearInterval(progressInterval);
            setTimeout(() => {
                generateLogEntry(`[SUCESSO] Chaves de sessão e certificados extraídos com sucesso para ${target.name}.`, 'success', bullrunLog);
                generateLogEntry(`[RELATÓRIO] Chave privada TLS 1.2: <strong>5a9b...</strong>. Chave de API: <strong>api_key_7c2f...</strong>`, 'success', bullrunLog);
            }, 500);
        }
    }, 200);
    openTab('bullrun', document.querySelector('.tab-button[onclick="openTab(\'bullrun\', this)"]'));
}

// --- LÓGICA DE PESQUISA XKEYSCORE ---
function runXkeyscoreSearch() {
    const query = document.getElementById('xkeyscoreInput').value;
    xkeyscoreResults.innerHTML = '';
    generateLogEntry(`[MECANISMO DE CONSULTA] Executando consulta avançada de dados globais para "${query}"...`, 'info', xkeyscoreResults);
    
    setTimeout(() => {
        const emailCount = Math.floor(Math.random() * 5000) + 100;
        const chatCount = Math.floor(Math.random() * 1500) + 50;
        const docCount = Math.floor(Math.random() * 300) + 20;

        generateLogEntry(`[RESULTADOS DE BD] Encontrados ${emailCount} e-mails, ${chatCount} registros de chat, ${docCount} documentos.`, 'info', xkeyscoreResults);

        if (query.toLowerCase().includes('plan')) {
            generateLogEntry(`[ALERTA] [ITEM SINALIZADO] [EMAIL] para: classified@gov | de: target@proton.me | assunto: "Re: The Plan" - sinalizado para conteúdo sensível.`, 'action', xkeyscoreResults);
            generateLogEntry(`[ALERTA] [ITEM SINALIZADO] [DOCUMENTO] plano-b.pdf, tamanho: 2.1MB, hash: 5a9b... - sinalizado para correspondência de palavra-chave.`, 'action', xkeyscoreResults);
        } else {
            generateLogEntry(`[ITEM SINALIZADO] [EMAIL] para: classified@gov | de: target@proton.me | assunto: "Re: The Plan" - sinalizado para conteúdo sensível.`, 'action', xkeyscoreResults);
        }

        generateLogEntry(`[CONSULTA CONCLUÍDA] Consulta XKEYSCORE finalizada.`, 'success', xkeyscoreResults);
    }, 2500);
}

function runStormcloudAnalysis() {
    if (targets.length === 0) {
        generateLogEntry("ERRO: Nenhum alvo ativo. Adquira um alvo para realizar a análise social.", 'action', xkeyscoreResults);
        return;
    }
    const target = getRandomItem(targets);
    xkeyscoreResults.innerHTML = '';
    generateLogEntry(`[STORMCLOUD] Iniciando análise de mídias sociais para o ALVO ${target.name}...`, 'info', xkeyscoreResults);
    
    setTimeout(() => {
        generateLogEntry(`[STORMCLOUD] Mapeando rede de contatos. Identificados <strong>${Math.floor(Math.random() * 20) + 5} conexões de 1° grau.</strong>`, 'info', xkeyscoreResults);
        
        // Simula a criação de um gráfico de conexões
        const graphDiv = document.createElement('div');
        graphDiv.className = 'social-graph-container';
        graphDiv.innerHTML = `Análise STORMCLOUD em andamento...`;
        xkeyscoreResults.appendChild(graphDiv);

        const targetNode = document.createElement('div');
        targetNode.className = 'graph-node main';
        targetNode.style.left = '50%';
        targetNode.style.top = '50%';
        graphDiv.appendChild(targetNode);

        const targetNameLabel = document.createElement('div');
        targetNameLabel.className = 'graph-text';
        targetNameLabel.style.left = '50%';
        targetNameLabel.style.top = '55%';
        targetNameLabel.textContent = `${target.name} (ALVO)`;
        graphDiv.appendChild(targetNameLabel);

        const numConnections = Math.floor(Math.random() * 5) + 3;
        const connections = [];
        for (let i = 0; i < numConnections; i++) {
            const angle = (2 * Math.PI / numConnections) * i;
            const x = 50 + 30 * Math.cos(angle);
            const y = 50 + 30 * Math.sin(angle);
            
            const connNode = document.createElement('div');
            connNode.className = 'graph-node';
            connNode.style.left = `${x}%`;
            connNode.style.top = `${y}%`;
            graphDiv.appendChild(connNode);

            const connName = getRandomItem(socialConnections);
            const connNameLabel = document.createElement('div');
            connNameLabel.className = 'graph-text';
            connNameLabel.style.left = `${x}%`;
            connNameLabel.style.top = `${y + 5}%`;
            connNameLabel.textContent = connName;
            graphDiv.appendChild(connNameLabel);
            connections.push(connName);
        }

        setTimeout(() => {
            graphDiv.innerHTML = '';
            generateLogEntry(`[STORMCLOUD] Análise de conexões sociais concluída. Identificados contatos chave.`, 'success', xkeyscoreResults);
            generateLogEntry(`[RELATÓRIO] Rede primária: ${connections.join(', ')}`, 'info', xkeyscoreResults);
        }, 3000);
        
    }, 2500);
    openTab('xkeyscore', document.querySelector('.tab-button[onclick="openTab(\'xkeyscore\', this)"]'));
}

// --- LÓGICA DO TERMINAL DE CAPTURA DE PACOTES ---
function openTerminal() {
    terminalWindow.style.display = 'block';
    if (!terminalInterval) {
        terminalContent.textContent = ''; // Limpa o conteúdo ao abrir
        simulatePacketCaptureLoop();
    }
}

function closeTerminal() {
    terminalWindow.style.display = 'none';
    clearInterval(terminalInterval);
    terminalInterval = null;
}

function simulatePacketCaptureLoop() {
    terminalInterval = setInterval(() => {
        const timestamp = new Date().toLocaleTimeString();
        const sourceIP = generateRandomIP();
        const destIP = generateRandomIP();
        const sourcePort = getRandomPort();
        const destPort = getRandomPort();
        const protocol = getRandomItem(["TCP", "UDP", "ICMP"]);
        const packetSize = Math.floor(Math.random() * 1500) + 60;
        const payload = getRandomPayload();
        
        const packetLine = `[${timestamp}] ${protocol} ${sourceIP}:${sourcePort} -> ${destIP}:${destPort} [${packetSize} bytes] -- ${payload}\n`;
        terminalContent.textContent += packetLine;
        terminalContent.scrollTop = terminalContent.scrollHeight; // Auto-scroll
    }, 500); // Adiciona um novo pacote a cada 500ms
}

// Lógica para tornar o terminal arrastável
const terminalTopbar = document.querySelector('.terminal-topbar');
let isDragging = false;
let startX, startY;
let initialX, initialY;

terminalTopbar.addEventListener('mousedown', (e) => {
    isDragging = true;
    startX = e.clientX;
    startY = e.clientY;
    initialX = terminalWindow.offsetLeft;
    initialY = terminalWindow.offsetTop;
    terminalWindow.style.transition = 'none'; // Desabilita transição durante o arraste
    terminalWindow.style.cursor = 'grabbing';
});

document.addEventListener('mousemove', (e) => {
    if (!isDragging) return;
    
    const dx = e.clientX - startX;
    const dy = e.clientY - startY;
    
    terminalWindow.style.left = `${initialX + dx}px`;
    terminalWindow.style.top = `${initialY + dy}px`;
    
    // Remove o transform para o arraste funcionar de forma nativa.
    terminalWindow.style.transform = 'none';
});

document.addEventListener('mouseup', () => {
    if (isDragging) {
        isDragging = false;
        terminalWindow.style.transition = ''; // Reabilita a transição
        terminalWindow.style.cursor = 'grab';
    }
});


// --- INICIALIZAÇÃO DO SISTEMA E LOOPS AUTOMATIZADOS ---
document.addEventListener('DOMContentLoaded', () => { 
    generateLogEntry("PRISM v5.0 Sistema Online. Aguardando aquisição de alvo...", 'success'); 
    
    // Geração de log de fundo automatizada
    setInterval(() => {
        if (Math.random() > 0.7) { // 30% de chance de logar
            const eventType = getRandomItem(systemEvents);
            generateLogEntry(`[SISTEMA] Processo em segundo plano: ${eventType}.`, 'info');
        }
    }, 5000);

    // Atualizações automatizadas de dados do alvo
    setInterval(() => { 
        targets.forEach(target => { 
            // Atualiza a localização com uma leve variação
            target.location.lat = (parseFloat(target.location.lat) + (Math.random() - 0.5) * 0.001).toFixed(5); 
            target.location.lon = (parseFloat(target.location.lon) + (Math.random() - 0.5) * 0.001).toFixed(5); 
            
            // Atualiza o fluxo de dados
            target.ip = generateRandomIP();
            target.protocol = generateRandomProtocol();

            // Adiciona/remove dispositivos conectados de forma aleatória
            const maxDevices = 5;
            if (target.connectedDevices.length < maxDevices && Math.random() > 0.5) {
                target.connectedDevices.push(getRandomItem(['Roteador', 'Câmera IP', 'Laptop', 'Smart TV', 'Impressora', 'Smartwatch']));
            } else if (target.connectedDevices.length > 0 && Math.random() > 0.8) {
                target.connectedDevices.pop();
            }

            const cardEl = document.getElementById(`card-${target.name.replace(/\s+/g, '-')}`); 
            if (cardEl) { 
                cardEl.querySelector('.data-lat').textContent = target.location.lat; 
                cardEl.querySelector('.data-lon').textContent = target.location.lon; 
                cardEl.querySelector('.data-bytes').textContent = generateRandomBytes();
                cardEl.querySelector('.data-ip').textContent = target.ip;
                cardEl.querySelector('.data-protocol').textContent = target.protocol;
                cardEl.querySelector(`#card-${target.name.replace(/\s+/g, '-')}-devices`).textContent = target.connectedDevices.length > 0 ? target.connectedDevices.join(', ') : 'Nenhum';
            }
        }); 
    }, 3000);
});

</script>
</body>
</html>
